<!-- Generated by solve-dynamo-spec.js. Update this documentation by updating the spec-v1.json file. -->

# HR Api Backend DynamoDB Spec

A DynamoDB table design corresponds to the relational order entry schema that is shown in Relational Modeling

## Table of Contents

-   [Table Spec](#table-spec)
-   [Access Patterns](#access-patterns)
    -   [Look up Employee Details by Employee ID](#look-up-employee-details-by-employee-id)
    -   [Query Employee Details by Employee Name](#query-employee-details-by-employee-name)
    -   [Get an employee's current job details only](#get-an-employees-current-job-details-only)
    -   [Get Open Orders for a customer for a date range](#get-open-orders-for-a-customer-for-a-date-range)
-   [Indexes](#indexes)
    -   [Main](#main)
    -   [Gsi1](#gsi1)
-   [Map Attributes](#map-attributes)

## Table Spec

<details>

<summary>Params to create the table using the CLI or the AWS SDK:</summary>

```json
{
  "AttributeDefinitions": [
    {
      "AttributeName": "PK",
      "AttributeType": "S"
    },
    {
      "AttributeName": "SK",
      "AttributeType": "S"
    },
    {
      "AttributeName": "Data",
      "AttributeType": "S"
    }
  ],
  "TableName": "HR-Table",
  "KeySchema": [
    {
      "AttributeName": "PK",
      "KeyType": "HASH"
    },
    {
      "AttributeName": "SK",
      "KeyType": "RANGE"
    }
  ],
  "ProvisionedThroughput": {
    "ReadCapacityUnits": 5,
    "WriteCapacityUnits": 5
  },
  "BillingMode": "PAY_PER_REQUEST",
  "GlobalSecondaryIndexes": [
    {
      "IndexName": "gsi1",
      "KeySchema": [
        {
          "AttributeName": "SK",
          "KeyType": "HASH"
        },
        {
          "AttributeName": "Data",
          "KeyType": "RANGE"
        }
      ],
      "Projection": {
        "ProjectionType": "ALL"
      },
      "ProvisionedThroughput": {
        "ReadCapacityUnits": 5,
        "WriteCapacityUnits": 5
      }
    }
  ]
}
```

</details>

`createTable` Using the CLI:

```bash
$ aws dynamodb create-table --table-name HR-Table --cli-input-json create-table.json
```

Using the AWS SDK:

```javascript
const DynamoDB = require("aws-sdk/clients/dynamodb");

const service = new DynamoDB({ region: process.env.AWS_REGION });

service.createTable(tableJson, (err, data) => {
  console.log(data);
});

```

## Access Patterns

### Look up Employee Details by Employee ID

Perform a [Get](http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#get-property "Get") against the Main index: 

```json
{
  "TableName": "HR-Table",
  "Key": {
    "PK": "HR-EMPLOYEE1",
    "SK": "EMPLOYEE1"
  }
}
```

#### Matching Records

| PK           | SK        | Data       | StartDate  |
| ------------ | --------- | ---------- | ---------- |
| HR-EMPLOYEE1 | EMPLOYEE1 | John Smith | 01-12-2019 |

### Query Employee Details by Employee Name

Perform a [Query](http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#query-property "Query") against the Gsi1 index with a `begins_with(#Data, :Data)` condition on the sort key:

```json
{
  "TableName": "HR-Table",
  "KeyConditionExpression": "#SK = :SK and begins_with(#Data, :Data)",
  "ExpressionAttributeNames": {
    "#SK": "SK",
    "#Data": "Data"
  },
  "ExpressionAttributeValues": {
    ":SK": "EMPLOYEE1",
    ":Data": "John"
  },
  "IndexName": "gsi1"
}
```

#### Matching Records

| PK           | SK        | Data       | StartDate  |
| ------------ | --------- | ---------- | ---------- |
| HR-EMPLOYEE1 | EMPLOYEE1 | John Smith | 01-12-2019 |

### Get an employee's current job details only

Perform a [Query](http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#query-property "Query") against the Main index with a `begins_with(#SK, :SK)` condition on the sort key:

```json
{
  "TableName": "HR-Table",
  "KeyConditionExpression": "#PK = :PK and begins_with(#SK, :SK)",
  "ExpressionAttributeNames": {
    "#PK": "PK",
    "#SK": "SK"
  },
  "ExpressionAttributeValues": {
    ":PK": "HR-EMPLOYEE1",
    ":SK": "v0"
  }
}
```

#### Matching Records

| PK           | SK  | Data                      |
| ------------ | --- | ------------------------- |
| HR-EMPLOYEE1 | v0  | Principle Account Manager |

### Get Open Orders for a customer for a date range

Perform a [Query](http://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html#query-property "Query") against the Gsi1 index with a `begins_with(#Data, :Data)` condition on the sort key:

```json
{
  "TableName": "HR-Table",
  "KeyConditionExpression": "#SK = :SK and begins_with(#Data, :Data)",
  "ExpressionAttributeNames": {
    "#SK": "SK",
    "#Data": "Data"
  },
  "ExpressionAttributeValues": {
    ":SK": "CUSTOMER1",
    ":Data": "OPEN#2019-01"
  },
  "IndexName": "gsi1"
}
```

#### Matching Records

| PK        | SK        | Data            | GSI-Bucket |
| --------- | --------- | --------------- | ---------- |
| OE-ORDER1 | CUSTOMER1 | OPEN#2019-01-18 | 6          |

## Indexes

### Main

| PK (HASH)    | SK (RANGE) |                                     |                           |
| ------------ | ---------- | ----------------------------------- | ------------------------- |
| HR-EMPLOYEE1 | EMPLOYEE1  | **Data:** John Smith                | **StartDate:** 01-12-2019 |
| HR-EMPLOYEE1 | v0         | **Data:** Principle Account Manager |                           |
| OE-ORDER1    | CUSTOMER1  | **Data:** OPEN#2019-01-18           | **GSI-Bucket:** 6         |

### Gsi1

| SK (HASH) | Data (RANGE)              |                      |                           |
| --------- | ------------------------- | -------------------- | ------------------------- |
| EMPLOYEE1 | John Smith                | **PK:** HR-EMPLOYEE1 | **StartDate:** 01-12-2019 |
| v0        | Principle Account Manager | **PK:** HR-EMPLOYEE1 |                           |
| CUSTOMER1 | OPEN#2019-01-18           | **PK:** OE-ORDER1    | **GSI-Bucket:** 6         |

## Map Attributes
